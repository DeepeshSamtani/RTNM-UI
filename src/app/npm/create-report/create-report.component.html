<div class="fixed-breadcrumb row">           
  
    <!-- <a class="ee-logo"><img src="./assets/images/ee-logo.png"  alt=""></a> -->
    <div class="page-title">
    <h2 class="single-line">{{editReport ? "Edit Report": "Create Report"}}</h2>
    </div>
    
  </div>

  <div class="fixed-tab-nav sm" >
    <div class="row">
     <div class="col-lg-12 col-sm-12">

        <ul class="nav nav-tabs pull-left" role="tablist">
            <li class="nav-item active">
              <a class="nav-link" data-toggle="tab" id="reportConfiguration" (click)="reportTabSelected='reportConfiguration'" href="#reportConfig" role="tab">{{editReport ? "Report Configuration ": "Report Type"}}</a>
            </li>
            <li class="nav-item">
              <a class="nav-link"  (click)="reportTabSelected='reportGeneration'" data-toggle="tab" id="reportGeneration" href="#filter" role="tab">Report Generation</a>
            </li>
             <li class="pull-right" *ngIf="editReport">
            <button type="button" class="btn btn-primary" (click)="backToOrigin()">Cancel</button>
          </li>
          </ul>

<div class="pull-right" >
  <ul class="action-menu">
     
      
        <!--<li>
          <a [title]="'Previous'" [class.disabled]="reportTabSelected=='reportConfiguration'" (click)="reportTabSelected='reportConfiguration';gotoReportGeneration(reportTabSelected)"><i class="icon-24 icon-prev"></i></a>
      </li>
       <li>
          <a [title]="'Next'" [class.disabled]="reportTabSelected=='reportGeneration'" (click)="reportTabSelected='reportGeneration';gotoReportGeneration(reportTabSelected)"><i class="icon-24 icon-next"></i></a>
      </li>-->
    <li>
      <a [title]="'Download CSV'" [class.disabled]="((!deviceTypeModel.controlgroup || deviceTypeModel.controlgroup.length==0)&&(!deviceTypeModel.controlgroupKPI || deviceTypeModel.controlgroupKPI.length ==0)) || !newReportForm.valid || (!tableResponse.data || tableResponse.data.length ==0) "
        (click)="exportReport('CSV')"><i class="icon-24 icon-download-csv"></i></a>

    </li>
    <li>
      <a [title]="'Download PDF'" [class.disabled]="((!deviceTypeModel.controlgroup || deviceTypeModel.controlgroup.length==0)&&(!deviceTypeModel.controlgroupKPI || deviceTypeModel.controlgroupKPI.length ==0)) || !newReportForm.valid || (!tableResponse.data || tableResponse.data.length ==0) "
        (click)="exportReport('PDF')"><i class="icon-24 icon-download-pdf"></i></a>

    </li>
    <li class="action-menu-li" *ngIf="!editReport">
      <a (click)="showTabHolder('#saveReportModal')" id="save1" data-toggle="tab" [class.disabled]="((!deviceTypeModel.controlgroup || deviceTypeModel.controlgroup.length==0)&&(!deviceTypeModel.controlgroupKPI || deviceTypeModel.controlgroupKPI.length ==0)) || !newReportForm.valid || (!tableResponse.data || tableResponse.data.length ==0) "
        title="Save"><i class="icon-24 icon-save"></i></a>
    </li>
      <li class="action-menu-li" *ngIf="editReport">
      <a (click)="createOrUpdateReport(true)" data-toggle="tab" id="save2" [class.disabled]="((!deviceTypeModel.controlgroup || deviceTypeModel.controlgroup.length==0)&&(!deviceTypeModel.controlgroupKPI || deviceTypeModel.controlgroupKPI.length ==0)) || !newReportForm.valid "
        title="Save"><i class="icon-24 icon-save"></i></a>
    </li>
    <!-- <li class="create">
      <a title="Create" class="" id="createReport" [ngClass]="{'update notification' : counterIds.length>0 }"  [class.disabled]="((!deviceTypeModel.controlgroup || deviceTypeModel.controlgroup.length==0)&&(!deviceTypeModel.controlgroupKPI || deviceTypeModel.controlgroupKPI.length ==0)) ||  ((!counterIds || counterIds.length == 0) )"
        type="button" (click)="clicked=true;createOrUpdateReport()"><i class="icon-create"></i></a>
    </li> -->
  </ul>

</div>
     </div>
    </div>
</div>

<div class="save-report tabHolder" id="saveReportModal" >
  <span class="arrow"></span>
  <h3>Please enter a report name to Save </h3>
  <div class="form-horizontal">
   <div class="form-group row adj-space-top">
       <div class="custom-form">
                      <div class="col-md-12">

                        <input type="text" class="form-control form-control-no " [(ngModel)]="ReportName" required>
                        <span class="icon-16 icn_clear_16 clear-btn hide" title="clear contents" (mousedown)="ReportName=''"></span>
                        <span class="bar"></span>
                        <label>Report Name</label>
                        <span class="add-error hide">Report Name<span></span></span>
                      </div>

                    </div>
                  
        </div>
         <div class="row mar-bottom-20">
              <div class="col-md-12 col-sm-12 text-center">
                <button type="button" class="btn btn-default closeButton"  (click)="ReportName=''" id="schedulerCancel">Cancel</button>
                <button type="button" class="btn btn-primary" id="schedulerSave" [class.disabled]="!ReportName || ReportName==''"  (click)="saveReport()"><i style="color:#fff;margin-top:2px;display:none;"  class="pull-right fa fa-spinner fa-pulse fa-1x "></i>Save</button>
              </div>
            </div>
    </div>
  
</div>

  <div class="container-fluid page-container top-tab" >
    <div class="main-container tab-container">
      <div class="modal fade" id="counterModal" role="dialog" >
        <div class="modal-dialog">
          Modal content
          <div class="modal-content">
            <div class="modal-header">
              <h4 class="modal-title">{{counterGroupPopUp.displayName}}</h4>
            </div>
            <div class="modal-body">
               <ng-template #spinner1>
                             
                          <!--<div style="padding-left:150px;height:50px;padding-top:15px;"><i class="fa fa-spinner fa-pulse fa-2x "></i></div>-->
                            <mat-spinner style="margin:20px auto 0;" diameter=40 color="accent"></mat-spinner>
                           
                          </ng-template>
              <div class="row">
                <div class="col-md-12">
                  <ul class="nav nav-tabs sub-tabs2" role="tablist">
                    <li class="nav-item active">
                      <a class="nav-link" data-toggle="tab" id="counterstabanchor" href="#counterstab" role="tab">Metrics</a>
                    </li>
                    <li class="nav-item">
                      <a class="nav-link" data-toggle="tab" href="#propertiestab" role="tab">Properties</a>
                    </li>
                     <li class="nav-item">
                      <a class="nav-link" data-toggle="tab" href="#counterskpitab" role="tab">KPI</a>
                    </li>
                  </ul>
                  <div class="tab-content no-space">
                    <div class="tab-pane active" id="counterstab" role="tabpanel">
                        <div class="alert alert-danger" *ngIf="clickSaved && (((getEnabledCounter(counterGroupPopUp,'counterList') || getEnabledCounter(counterGroupPopUp,'kpis')) && !getEnabledCounter(counterGroupPopUp,'properties')) || 
                       ((!getEnabledCounter(counterGroupPopUp,'counterList') && !getEnabledCounter(counterGroupPopUp,'kpis')) && getEnabledCounter(counterGroupPopUp,'properties')))
                        ">
                            <strong>Alert!</strong> Please select atleast 1 property and 1 metric/kpi 
                          </div>
                      <div class="row" *ngIf="!counterLoading && counterGroupPopUp.counterList && counterGroupPopUp.counterList.length>0">
                          <div class="serach-category fixed">
                            <input type="text" class="search-query sm" placeholder="Search" [(ngModel)]="counterGroupPopUp.search">
                            <button type="submit" class="search-btn"><span class="glyphicon glyphicon-search" aria-hidden="true"></span></button>
                          </div>
                        
                        <!--<div class="col-md-12">
                          <div class="pull-right">
                            <div class="form-check">
                              <input class="form-check-input customCheck circle" type="checkbox" [(ngModel)]="counterGroupPopUp.showAll" (change)="addAllCounterIds(counterGroupPopUp,counterGroupPopUp.showAll,'counters');"
                                [attr.id]="'counters-'+i">
                              <label class="form-check-label" [attr.for]="'counters-'+i">Add all</label>
                            </div>
                          </div>
                        </div>-->

                      </div>

                      <div class="row adj-space">
                        <div class="col-md-12 " >
                          <div *ngIf="counterLoading && (!counterGroupPopUp.counterList || counterGroupPopUp.counterList.length ==0) then spinner1">
                       
                          </div>
                                                
                       <virtual-scroll #scroll [childHeight]="5" (update)="viewPortItems = $event" [items]="counterGroupPopUp.counterList | searchpipe : counterGroupPopUp.search : ['displayName']" > 
                         <ul class="counter-list-item " *ngIf="counterGroupPopUp.counterList && counterGroupPopUp.counterList.length>0">
                              <li class="col-md-4" *ngFor="let counter of viewPortItems;let k =index;" style="list-style:none;">
                                
                                <div class="form-check " style="margin-left:15px;">
                                  <input class="form-check-input customCheck"     type="checkbox" [attr.id]="'counter-'+k" [(ngModel)]="counter.showEnable" (change)="addCounterIds(counter,counter.showEnable,counterGroupPopUp,'counters')">
                                  <label class="form-check-label ellipsis" [title]="counter.displayName+' ('+counter.counterUnit+')'+'=>'+counter.counterDescription" [attr.for]="'counter-'+k">{{ counter.displayName+'('+counter.counterUnit+')'}}</label>
                                </div>
                             
                              </li>
                         </ul>
                           <div *ngIf="!counterLoading && (!counterGroupPopUp.counterList || counterGroupPopUp.counterList.length ==0)" class="no-counters">No Metrics to display in this metric group</div>
                        
                         </virtual-scroll>
                         
                         <!--<div *ngIf="counterGroupPopUp.counterList || counterGroupPopUp.counterList?.length<0 then spinner1">
                         </div>-->
                           <ng-template #largeList>
                        
                            </ng-template>
                                                </div>
                      </div>
                    </div>
                    <div class="tab-pane" id="propertiestab" role="tabpanel">
                       <div *ngIf="(counterLoading && (!counterGroupPopUp.properties || counterGroupPopUp.properties.length==0)) then spinner1">
                         </div>
                       <div class="alert alert-danger" *ngIf="clickSaved && ((getEnabledCounter(counterGroupPopUp,'counterList') || getEnabledCounter(counterGroupPopUp,'kpis')) && !getEnabledCounter(counterGroupPopUp,'properties')) || 
                       ((!getEnabledCounter(counterGroupPopUp,'counterList') && !getEnabledCounter(counterGroupPopUp,'kpis')) && getEnabledCounter(counterGroupPopUp,'properties'))
                        ">
                            <strong>Alert!</strong> Please select atleast 1 property and 1 Metric/kpi 
                          </div>

                      <div class="row">
                          <div class="serach-category fixed">
                           <input type="text" class="search-query sm" placeholder="Search" [(ngModel)]="counterGroupPopUp.searchProp">
                            <button type="submit" class="search-btn"><span class="glyphicon glyphicon-search" aria-hidden="true"></span></button>
                          </div>
                      

                        <!--<div class="col-md-12">
                          <div class="pull-right" *ngIf="counterGroupPopUp?.properties">
                            <div class="form-check">
                              <input class="form-check-input customCheck circle"   type="checkbox"  [(ngModel)]="counterGroupPopUp.showAllProps" (change)="addAllProperties(counterGroupPopUp,counterGroupPopUp.showAllProps)"
                                [attr.id]="'properties'+counterGroupPopUp.counterGroupId">
                              <label class="form-check-label " [attr.for]="'properties'+counterGroupPopUp.counterGroupId">Add all</label>
                            </div>
                          </div>
                        </div>-->

                      </div>
                      <ul *ngIf="counterGroupPopUp.properties;else spinner1" class="counter-list-item dropdown-overflow-popup">
                        <li *ngFor="let property of counterGroupPopUp.properties | searchpipe : counterGroupPopUp.searchProp : ['propertyName']  ;let k=index;">
                          <div class="form-check">
                            <input class="form-check-input customCheck" type="checkbox"  [attr.id]="'property'+property.id" [(ngModel)]="property.showEnable" (change)="addProperties(property.propertyName,property.showEnable,property,counterGroupPopUp);">
                            <label class="form-check-label ellipsis" [attr.for]="'property'+property.id">{{ property.propertyName }}<span class="sub-txt" *ngIf="property.filterArray &&  property.filterArray.length>0"> (By default all values of the property are returned.If u need any filter, select from the below specific values)</span></label>
                          </div>
               <!--<select *ngIf="property.propertyValues"  [attr.id]="'property-filter'+property.id" class="filter-select" [ngClass]="{ 'disabled' : !property.showEnable}"  [(ngModel)]="property.filterValue" (ngModelChange)="addProprtyFilter(property,property.filterValue)">
                        
                  <option *ngFor="let value of property.propertyValues.values" [attr.value]="value"  (click)="property.filterValue = value;propertyfilterValue=value">
                  {{value}}
                  </option>
                
                </select> -->
                <div class="row pro-filters"  *ngIf="property.showEnable && property.filterArray.length>0">
                  <div class="alert alert-danger" style="margin:10px;" *ngIf="clickSavedProperty && !getEnabledCounter(property,'filterArray') 
                        "><strong>Alert!</strong> Please select a sub property for the selected property
                          </div>
                  <div class="form-check col-md-3" *ngFor="let prop of property.filterArray">
                            <input class="form-check-input customCheck" type="checkbox"  [attr.id]="'propertyvalue'+prop.value" [(ngModel)]="prop.showEnable" (change)="addProprtyFilter(property,prop)">
                            <label class="form-check-label ellipsis" [attr.for]="'propertyvalue'+prop.value">{{ prop.value}}</label>
                          </div>
                  </div>
                        </li>
                      </ul>
                    </div>
                    <div class="tab-pane" id="counterskpitab" role="tabpanel">
                       <div *ngIf="(counterLoading && (!counterGroupPopUp.kpis || counterGroupPopUp.kpis.length==0)) then spinner1">
                         </div>
                      <div class="alert alert-danger" *ngIf="clickSaved && ((getEnabledCounter(counterGroupPopUp,'counterList') || getEnabledCounter(counterGroupPopUp,'kpis')) && !getEnabledCounter(counterGroupPopUp,'properties')) || 
                       ((!getEnabledCounter(counterGroupPopUp,'counterList') && !getEnabledCounter(counterGroupPopUp,'kpis')) && getEnabledCounter(counterGroupPopUp,'properties'))
                        ">
                            <strong>Alert!</strong> Please select atleast 1 property and 1 Metric/kpi 
                          </div>
                    <div class="row" *ngIf="!counterLoading && counterGroupPopUp.kpis && counterGroupPopUp.kpis.length>0" >
                     <div class="serach-category fixed">
                          <input type="text" class="search-query sm" placeholder="Search" [(ngModel)]="counterGroupPopUp.searchKPI">
                          <button type="submit" class="search-btn"><span class="glyphicon glyphicon-search" aria-hidden="true"></span></button>
                        </div>
                    </div>

                    <ul *ngIf="(counterGroupPopUp.kpis && counterGroupPopUp.kpis.length>0)" class="counter-list-item dropdown-overflow">
                      <li class="col-md-6" *ngFor="let kpi of counterGroupPopUp.kpis | searchpipe : counterGroupPopUp.searchKPI : ['displayName'];let k=index;">
                        
                        <div class="form-check ">
                          <input class="form-check-input customCheck" type="checkbox"   [(ngModel)]="kpi.showEnable" (change)="addCounterIds(kpi,kpi.showEnable,counterGroupPopUp,'kpi');"
                            [attr.id]="'kpi'+i+k">
                          <label class="form-check-label ellipsis" [title]="kpi.displayName+'('+kpi.counterUnit+') =>'+ kpi.counterDescription" [attr.for]="'kpi'+i+k">{{kpi.displayName+'('+kpi.counterUnit+')' }}</label>
                        </div>
                       

                      </li>

                    </ul>
                   
                           <div class="no-counters" *ngIf="(!counterLoading && (!counterGroupPopUp.kpis || counterGroupPopUp.kpis.length==0))">No kpis to display in this Metric group</div>
                    
                  </div></div>
                </div>
              </div>

            </div>
            <div class='modal-footer'>
              <button type='button' class="btn btn-primary"  (click)="clickSaved=true;closeModal('counterModal',counterGroupPopUp)">Save & Close</button>
              </div>
          </div>
        </div>
      </div>

    <!-- Tab panes -->
      <div class="scroll-tab-content1">
      <form class="form-horizontal" validate [formGroup]="newReportForm">
        <div class="tab-content">
          <div class="tab-pane active" id="reportConfig" role="tabpanel">
            <div class="row">
              <!-- Column Right one-column -->
              <div class="col-md-12">
                <div class="custom-form">
                    <div *ngIf="editReport" class="form-group row adj-space-top">
                      <div class="col-md-6">

                        <input type="text" class="form-control form-control-no " formControlName="ReportTitle" required>
                        <span class="icon-16 icn_clear_16 clear-btn hide" title="clear contents" (mousedown)="newReportForm.controls['ReportTitle'].setValue('')"></span>
                        <span class="bar"></span>
                        <label>Report Name</label>
                        <span class="add-error hide">Report Name<span></span></span>
                      </div>

                    </div>

                    <!-- Report Type -->
                    <div class="form-group row adj-space-top offset-bottom20">
                      <div class="col-md-12">
                        <label class="label">Report Type</label>

                        <div class="row report-type">
                          <div class="type-block" *ngFor="let report of reportTypeConfigList;let i =index;">
                            <h2 class="clearfix"><span [attr.class]="report.class"></span> <span>{{report.type}}</span></h2>
                            <ul class="type-list">
                              <li  *ngFor="let reportSubType of report.subtype">
                                <input type="radio" [hidden]="true" formControlName="ReportType" style="visibility:hidden;">
                                <a [ngClass]="{'active' : ( ( newReportForm.controls['ReportType'].value).subType==reportSubType.name  && ( newReportForm.controls['ReportType'].value).type==report.type )}"
                                  (click)="selectedReportType(reportSubType , report.type);">
          <span class="image"><img src="{{reportSubType.image}}" /></span>
          <span class="text">{{reportSubType.name}}</span>
           <!--<span [ngClass]="{'tick-mark' : ( ( newReportForm.controls['ReportType'].value).subType==reportSubType.name  && ( newReportForm.controls['ReportType'].value).type==report.type )}"></span>-->
          </a>
                              </li>

                            </ul>
                          </div>

                        </div>
                        <div class="warning-msg" [hidden]="!showInfoMessage" id="graphInfoMessage">
                          <div class="alert alert-warning">
                            <span class="glyphicon glyphicon-info-sign" aria-hidden="true"></span>
                           <span class="txt">
                            <strong>Info:</strong> Only 5 Metrics and KPIs are allowed for graph report.
                          </span>
                          </div>
                        </div>

                      </div>
                    </div>
                    <!--<div class="form-group row adj-space">
                      <div class="col-md-6">
                        <div class="row">
                          <div class="col-sm-4 dropdown">
                            <input type="text" class="form-control form-control-no dropdown" [element-id]="'timestring'" [form-validator]="newReportForm.controls['timestring'].value"
                              [validate]="TriggeredSave" (isFormValid)="ValidateForm($event)" (focus)="showDropdown($event);"
                             (blur)="hideDropdown($event)" required formControlName="timestring">
                                <span class="icon-16 icn_clear_16 clear-btn hide" title="clear contents" (mousedown)="setFormControlValues('','timestring');"></span>
                            <div class="drop-items drop-list hide">
                              <ul class="dropdown-overflow">
                                <li *ngFor="let timestring of newReportModel.timeStringList | searchpipe : newReportForm.get('timestring').value" (mousedown)="setFormControlValues(timestring,'timestring');">
                                  <label>{{timestring}}</label>
                                </li>
                              </ul>
                            </div>
                            <span class="bar"></span>
                            <label>Duration</label>
                            <span class="add-error hide">Duration<span></span></span>
                          </div>
                          <div class="col-sm-4 dropdown" [hidden]="newReportForm.controls['timestring'].value=='Custom'">
                            <input type="text" class="form-control form-control-no dropdown" (focus)="showDropdown($event);" (blur)="hideDropdown($event)"
                              required formControlName="timerange">
                             <span class="icon-16 icn_clear_16 clear-btn hide" title="clear contents" (mousedown)="setFormControlValues('','timerange');"></span>
                            <div class="drop-items drop-list hide">
                              <ul class="dropdown-overflow">
                                <li *ngFor="let timerange of newReportModel.timeRangeList | searchpipe : newReportForm.get('timerange').value" (mousedown)="setFormControlValues(timerange,'timerange');">
                                  <label>{{timerange}}</label>
                                </li>
                              </ul>
                            </div>
                            <span class="bar"></span>
                            <label>Time Range</label>
                            <span class="add-error hide">Time Range<span></span></span>
                          </div>
                          <div class="col-md-4" [hidden]="newReportForm.controls['timestring'].value!='Custom'">
                            <input type="text" class="form-control form-control-no" required formControlName="fromDate" id="datePicker" />
                            <span class="bar"></span>
                            <label>From</label>
                            <span class="add-error hide">From date<span></span></span>
                            <div #datePicker></div>
                            <span class="calender-icon"></span>
                          </div>
                          <div class="col-md-4 cal-hold-icon" [hidden]="newReportForm.controls['timestring'].value!='Custom'">
                            <input type="text" class="form-control form-control-no" required formControlName="toDate" id="todatePicker" />
                            <span class="bar"></span>
                            <label>To</label>
                            <span class="add-error hide">To date<span></span></span>
                            <div #todatePicker></div>
                            <span class="calender-icon"></span>
                          </div>
                        </div>
                      </div>
                      <div class="col-md-5 alert help-info">
                          <span class="icon-16 help pull-left" tooltip="The time inetrval used for report"></span>
                        </div>
                    </div>
                    <div class="form-group row adj-space">
                      <div class="col-md-6 dropdown">
                        <input type="text" class="form-control form-control-no dropdown" (focus)="showDropdown($event);" (blur)="hideDropdown($event);"
                          formControlName="granularity" required>
                           <span class="icon-16 icn_clear_16 clear-btn hide" title="clear contents" (mousedown)="setFormControlValues('','granularity');"></span>
                        <div class="drop-items drop-list hide">
                          <ul>
                           <li *ngFor="let granularity of newReportModel.granularities  | searchpipe : newReportForm.get('granularity').value" (mousedown)="setFormControlValues(granularity,'granularity')">{{ granularity }}</li>
                          </ul>
                        </div>
                        <span class="bar"></span>
                        <label>Aggregation granularity</label>
                        <span class="add-error hide">Aggregation granularity<span></span></span>
                      </div>

                    </div>-->

                    <div class="row">
                      <div class="col-md-6">
                        <div class="pull-right">
                          <a class="btn btn-primary"  (click)="gotoReportGeneration('reportGeneration')">Next</a>
                        </div>
                      </div>
                    </div>
                </div>
              </div>
            </div>
          </div>
          <div class="tab-pane reoprt-details" id="filter" role="tabpanel">
            <div>
              <div class="row">

                <div class="col-md-12">
                  <div class="custom-form">
                   
                   <div class="form-group row adj-space-bottom">
                      <div class="col-sm-3 dropdown">
                        <input type="text" class="form-control form-control-no dropdown" #deviceType="ngModel" [(ngModel)]="element" [ngModelOptions]="{standalone: true}" required [ngClass]="(deviceType.errors && (deviceType.dirty || deviceType.touched)) ? 'error-field':''">
                        <span class="icon-16 icn_clear_16 clear-btn hide" title="clear contents" (mousedown)="element='';clearAllData();"></span>
                        <div class="drop-items drop-list hide">
                          <ul class="dropdown-overflow">
                            <li *ngFor="let element of elements | searchpipe : element" (focus)="showDropdown($event);" (mousedown)="selectDeviceType(element,$event);" (blur)="hideDropdown($event)">
                              <label>{{element}}</label>
                            </li>
                          </ul>
                        </div>
                        <span class="bar"></span>
                        <label>Device Type</label>
                        <span class="add-error hide">Metrics Group<span></span></span>
                      <span *ngIf="deviceType.errors && (deviceType.dirty || deviceType.touched)"><span class="add-error error-text">Please select a device type</span></span>
                      </div>

                           <div class="col-sm-3 dropdown">
                            <input type="text" class="form-control form-control-no dropdown"  [ngClass]="commonFieldErrorUtilService.displayFieldCss('timestring')"
                             (focus)="showDropdown($event);"
                              (blur)="hideDropdown($event)" required formControlName="timestring">
                                <span class="icon-16 icn_clear_16 clear-btn hide" title="clear contents" (mousedown)="setFormControlValues('','timestring');"></span>
                            <div class="drop-items drop-list hide">
                              <ul class="dropdown-overflow">
                                <li *ngFor="let timestring of newReportModel.timeStringList | searchpipe : newReportForm.get('timestring').value" (mousedown)="setFormControlValues(timestring,'timestring');">
                                  <label>{{timestring}}</label>
                                </li>
                              </ul>
                            </div>
                            <span class="bar"></span>
                            <label>Duration</label>
                            <span class="add-error hide">Duration<span></span></span>
                            <span *ngIf="commonFieldErrorUtilService.displayDropdownErrorField('timestring')"><span class="add-error error-text">Please select a time interval from the given values</span></span>
                          </div>
                          <div class="col-sm-3 dropdown" [hidden]="newReportForm.controls['timestring'].value=='Custom'">
                            <input type="text" class="form-control form-control-no dropdown" (focus)="showDropdown($event);" (blur)="hideDropdown($event)" [ngClass]="commonFieldErrorUtilService.displayFieldCss('timerange')" 
                              required formControlName="timerange">
                             <span class="icon-16 icn_clear_16 clear-btn hide" title="clear contents" (mousedown)="setFormControlValues('','timerange');"></span>
                            <div class="drop-items drop-list hide">
                              <ul class="dropdown-overflow">
                                <li *ngFor="let timerange of newReportModel.timeRangeList | searchpipe : newReportForm.get('timerange').value" (mousedown)="setFormControlValues(timerange,'timerange');">
                                  <label>{{timerange}}</label>
                                </li>
                              </ul>
                            </div>
                            <span class="bar"></span>
                            <label>Time Range</label>
                            <span class="add-error hide">Time Range<span></span></span>
                                <span *ngIf="commonFieldErrorUtilService.displayDropdownErrorField('timerange')"><span class="add-error error-text">Please select a range from the given values</span></span>
                          </div>
                          <div class="col-md-2" [hidden]="newReportForm.controls['timestring'].value!='Custom'">
                            <input type="text" class="form-control form-control-no"  required formControlName="fromDate" id="datePicker" [ngClass]="commonFieldErrorUtilService.displayFieldCss('fromDate')" />
                            <span class="bar"></span>
                            <label>From</label>
                            <span class="add-error hide">From date<span></span></span>
                            <div #datePicker></div>
                            <span class="calender-icon"></span>
                             <span *ngIf="commonFieldErrorUtilService.isFieldValid('fromDate')"><span class="add-error error-text">Please select a start date</span></span>
                          </div>
                          <div class="col-md-2 cal-hold-icon" [hidden]="newReportForm.controls['timestring'].value!='Custom'">
                            <input type="text" class="form-control form-control-no"  required formControlName="toDate" id="todatePicker" [ngClass]="commonFieldErrorUtilService.displayFieldCss('toDate')" />
                            <span class="bar"></span>
                            <label>To</label>
                            <span class="add-error hide">To date<span></span></span>
                            <div #todatePicker></div>
                            <span class="calender-icon"></span>
                             <span *ngIf="commonFieldErrorUtilService.isFieldValid('toDate')"><span class="add-error error-text">Please select an end date</span></span>
                             
                          </div>

                           <div class="pull-right prev-btn">
                              <a class="btn btn-primary" (click)="gotoReportGeneration('reportConfiguration')">Back</a>
                           </div>

                        </div>
                          </div>
                          <div class="form-group row adj-space-bottom">

                          <div class="col-md-3 custom-form dropdown">
                              <input type="text" class="form-control form-control-no dropdown"  (focus)="showDropdown($event);" (blur)="hideDropdown($event);" [ngClass]="commonFieldErrorUtilService.displayFieldCss('granularity')"
                                formControlName="granularity" required>
                                 <span class="icon-16 icn_clear_16 clear-btn hide" title="clear contents" (mousedown)="setFormControlValues('','granularity');"></span>
                              <div class="drop-items drop-list hide">
                                <ul>
                                  <li *ngFor="let granularity of newReportModel.granularities  | searchpipe : newReportForm.get('granularity').value" (mousedown)="setFormControlValues(granularity,'granularity')">{{ granularity }}</li>
                                </ul>
                              </div>
                              <span class="bar"></span>
                              <label>Aggregation <span class="sub-txt">(Based on time)</span></label>
                              <span class="add-error hide">Aggregation  <span class="sub-txt">(Based on time)</span><span></span></span>
                               <span *ngIf="commonFieldErrorUtilService.displayDropdownErrorField('granularity')"><span class="add-error error-text">Please select a granularity from the given values</span></span>
                            </div>

                         
                      <div class="col-md-3  aggregation-column">
                        <label class="frm-label">Aggregation <span class="sub-txt">(Based on property)</span></label>
                        <div class="form-check ">
                              <input class="form-check-input customCheck" type="checkbox" name="radioTest" [(ngModel)]="grouped" id="radio2" [checked]="this.reportDataType == 'grouped'"
                                (ngModelChange)="setReportDataType('grouped',grouped)" [ngModelOptions]="{standalone: true}"/>
                              <label class="form-check-label" for="radio2">Grouped</label>
                            </div>
                         
                          </div>
                       
                  
                      <!--<div class="col-sm-4 dropdown" [hidden]="element=='DSR'">
                        <input type="text" class="form-control form-control-no dropdown" name="controlgroup" [(ngModel)]="deviceTypeModel.elementUserLabel"
                          required> <span class="icon-16 icn_clear_16 clear-btn hide" (mousedown)="deviceTypeModel={}"></span>
                        <div class="drop-items drop-list hide">
                          <ul *ngIf="nodes && nodes.length>0;else spinner1" class="dropdown-overflow">
                            <li (mousedown)="addJSONParsedModel('all',$event);">
                              <label>All Nodes</label>
                            </li>
                            <li *ngFor="let device of nodes | searchpipe : deviceTypeModel.elementUserLabel : ['elementUserLabel']" (mousedown)="addJSONParsedModel(device,$event);">
                              <label>{{device.elementUserLabel}}</label>
                            </li>

                          </ul>
                          <ng-template #spinner1>
                            <div style="padding-left:150px;height:50px;padding-top:15px;"><i class="fa fa-spinner fa-pulse fa-2x "></i></div>
                            <div class="sk-wave">

                              <div class="sk-rect sk-rect1"></div>
                              <div class="sk-rect sk-rect2"></div>
                              <div class="sk-rect sk-rect3"></div>
                              <div class="sk-rect sk-rect4"></div>
                              <div class="sk-rect sk-rect5"></div>
                            </div>
                          </ng-template>
                        </div>
                        <span class="bar"></span>
                        <label>Node </label>
                        <span class="add-error hide">Counter Group<span></span></span>

                      </div>-->

                   
                  </div>
   

                  <div class="" *ngIf="element">
                    <!--<ul class="nav nav-tabs sub-tabs2" role="tablist">
                      <li class="nav-item active">
                        <a class="nav-link" data-toggle="tab" href="#Counters" (click)="clearArrays('Counters');" role="tab">Counters</a>
                      </li>
                      <li class="nav-item">
                        <a class="nav-link" data-toggle="tab" href="#Kpi" (click)="clearArrays('Kpi');" role="tab">KPI</a>
                      </li>
                    </ul>-->
                    <!--<div class="tab-content sub-tab-content">-->
                      <div  id="Counters" >
                        <div class="row form-top" *ngIf="element">
                           <div class="col-md-12">
                          <div class="pull-left">
                            <h3 class="section-title">Metric Groups</h3>
                         </div>
                         <div class="pull-right">
                        <div class="serach-category">
                                <input type="text" class="search-query" placeholder="Search" [(ngModel)]="searchCG" [ngModelOptions]="{standalone: true}">
                                <button type="submit" class="search-btn"><span class="glyphicon glyphicon-search" aria-hidden="true"></span></button>
                         </div>
                         </div>
                         </div>
                        </div>

                        <div class="row" *ngIf="deviceTypeModel.controlgroup && deviceTypeModel.controlgroup.length>0;else spinner1" >
                            <!--<virtual-scroll style="height:200px;" [items]="deviceTypeModel.controlgroup | searchpipe : searchCG : ['displayName']" (update)="scrollListGroup = $event">-->
                          <div class="col-md-3" *ngFor="let counterGroup1 of deviceTypeModel.controlgroup | searchpipe : searchCG : ['displayName'];let i=index;">
                        <div *ngIf="i<12 || showMoreItems">
                              <div class="counter" [id]="counterGroup1.displayName">

                                <a class="counter-groups"name="countergroup" data-backdrop="static"  data-keyboard="false" [id]="counterGroup1.counterGroupId+'counters'" [title]="counterGroup1.displayName" [ngClass]="{'has-enabled-counters' : getEnabledCounter(counterGroup1,'counterList') , 'has-enabled-properties' : getEnabledCounter(counterGroup1,'properties') ,'has-enabled-kpis' : getEnabledCounter(counterGroup1,'kpis')}"
                                  data-toggle="modal" href="#counterModal" (click)="addCountersIntoGroup(counterGroup1,true,$event);">
                                      <span class="ellipsis">{{counterGroup1.displayName}}</span>
                                      <span  class="selected-counetrs" *ngIf="getEnabledCounterLength(counterGroup1,'counterList')>0|| getEnabledCounterLength(counterGroup1,'properties')>0 || getEnabledCounterLength(counterGroup1,'kpis')>0">{{getEnabledCounterLength(counterGroup1,'counterList')+getEnabledCounterLength(counterGroup1,'properties')+ getEnabledCounterLength(counterGroup1,'kpis')}}</span>
                                </a>
                              </div> 
                          </div>
                          </div>
                            <!--</virtual-scroll>-->
                        </div>
                        <div class="row">
                          <div class="col-md-12">
                      
                            <div class="pull-right">
                               
                              <a data-toggle="collapse" data-target="#selectedCounters"><span class="more-items">View Selected Metrics</span></a>
                             <a *ngIf="(!searchCG || searchCG.length<0) && deviceTypeModel.controlgroup && deviceTypeModel.controlgroup.length >12" (click)="showMoreItems = ! showMoreItems;"><span class="more-items" *ngIf="showMoreItems ">Show Less Items</span><span class="more-items" *ngIf="!showMoreItems ">Show More Items</span></a>
                          <a class="btn btn-primary btn-submit" [class.disabled]="((!deviceTypeModel.controlgroup || deviceTypeModel.controlgroup.length==0)&&(!deviceTypeModel.controlgroupKPI || deviceTypeModel.controlgroupKPI.length ==0)) ||  ((!counterIds || counterIds.length == 0) )"
        type="button" (click)="createOrUpdateReport()">Preview</a>
                            </div>

                          </div>

                        </div>

                        <div class="counters">

                          <div class="row v-scroll collapse" id="selectedCounters">
                            <div class="row form-top space-adj">
                              <div class="col-md-12">
                                <h3 class="section-title pull-left">Selected Metrics</h3>
                              </div>
                            </div>
                            <ng-template ngFor [ngForOf]="deviceTypeModel.controlgroup" let-cg>
                              <div [ngClass]="(getEnabledCounter(cg,'kpis')  && getEnabledCounter(cg,'counterList') && getEnabledCounter(cg,'properties')) ||((getEnabledCounter(cg,'kpis')  && getEnabledCounter(cg,'counterList'))  || (getEnabledCounter(cg,'counterList')&& getEnabledCounter(cg,'properties')) || (getEnabledCounter(cg,'kpis')&& getEnabledCounter(cg,'properties')))? 'col-md-6':'col-md-3'"
                                                *ngIf="getEnabledCounter(cg,'counterList') || getEnabledCounter(cg,'properties')">
                                <div class="counter-card" *ngIf="(getEnabledCounter(cg,'counterList') || getEnabledCounter(cg,'properties') || getEnabledCounter(cg,'kpis'));">
                                  <h4 class="panel-title"><span class="ellipsis">{{cg.displayName}}</span></h4>
                                  <div class="row panel-content">
                                    <div class="" [ngClass]="(getEnabledCounter(cg,'properties') && getEnabledCounter(cg,'kpis')) ? 'col-md-4 v-border':(getEnabledCounter(cg,'properties') || getEnabledCounter(cg,'kpis') ? 'col-md-6 v-border' : 'col-md-12')"
                                      *ngIf="getEnabledCounter(cg,'counterList');">
                                      <div class="row">
                                        <div class="col-md-12">
                                          <span class="border-heading">Metrics</span>
                                        </div>
                                      </div>
                                      <ul class="card-items">
                                        <ng-template ngFor let-counters [ngForOf]="cg.counterList">
                                          <li *ngIf="counters.showEnable" ><span class="ellipsis" [title]="counters.displayName+'('+counters.counterUnit+')'">{{counters.displayName+'('+counters.counterUnit+')'}}</span></li>
                                        </ng-template>
                                      </ul>
                                    </div>
                                        <div class="" [ngClass]="(getEnabledCounter(cg,'counterList') && getEnabledCounter(cg,'properties')) ? 'col-md-4 v-border':(getEnabledCounter(cg,'properties') || getEnabledCounter(cg,'counterList') ? 'col-md-6 v-border' : 'col-md-12')" *ngIf="getEnabledCounter(cg,'kpis');">
                                      <div class="row">
                                        <div class="col-md-12">
                                          <span class="border-heading">KPI</span>
                                        </div>
                                      </div>
                                      <ul class="card-items">
                                        <ng-template ngFor let-kpi [ngForOf]="cg.kpis">
                                          <li *ngIf="kpi.showEnable"><span class="ellipsis" [title]="kpi.displayName+'('+kpi.counterUnit+')'">{{kpi.displayName+'('+kpi.counterUnit+')'}}</span></li>
                                        </ng-template>
                                      </ul>
                                    </div>
                                    <div class="" [ngClass]="(getEnabledCounter(cg,'counterList') && getEnabledCounter(cg,'kpis')) ? 'col-md-4 ':(getEnabledCounter(cg,'counterList') || getEnabledCounter(cg,'kpis') ? 'col-md-6' : 'col-md-12')" *ngIf="getEnabledCounter(cg,'properties');">
                                      <div class="row">
                                        <div class="col-md-12">
                                          <span class="border-heading">Properties</span>
                                        </div>
                                      </div>
                                      <ul class="card-items">
                                        <ng-template ngFor let-properties [ngForOf]="cg.properties">
                                          <li *ngIf="properties.showEnable"><div class="row"><div class="col-md-6"><span class="ellipsis" [title]="properties.propertyName">{{properties.propertyName}}</span></div><div class="col-md-6"><span *ngIf="properties.selectedValues && properties.selectedValues.length>0" [title]="getCommaseperatedValues(properties.selectedValues)" class="ellipsis filter-lbl">{{getCommaseperatedValues(properties.selectedValues)}}</span></div></div></li>
                                        </ng-template>
                                      </ul>
                                    </div>
                                 
                                  </div>
                                </div>
                              </div>
                            </ng-template>
                          </div>
                        </div>

                      </div>
                     
                      <div class="row">
                        <div class="col-md-12">
                          <div class="row form-top" [hidden]="!response || response.length ==0">
                            <div class="col-md-12" *ngIf="editReport">
                              <a class="title-link">{{newReportForm.controls['ReportTitle'].value}}</a>
                            </div>

                          </div>
                          <app-chart-table [showGraph]="showGraph"  [defaultType]="(newReportForm.controls['ReportType'].value).type" [height]="350" *ngIf="response" [response]="response" [refreshContinously]="refreshDataContinuously"
                            (emitSubElement)="selectedSubElement($event);" [eventData]="tableResponse" [index]="0" [type]="(newReportForm.controls['ReportType'].value).subType"
                            [menuToggle]="menuToggle" [tableSearch]="searchData" [counterListForReport]="counterListForReport"></app-chart-table>
                            <div *ngIf="isLoading">
                              <mat-spinner style="margin:auto;" diameter=60 color="accent"></mat-spinner>
                      </div>
                        </div>
                      </div>

                    <!--</div>-->
                  </div>

                </div>
              </div>
            </div>
          </div>
        </div>
        </form>
      </div>
    </div>
  </div>
